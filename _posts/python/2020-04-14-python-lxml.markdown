---
layout: post
title:  "íŒŒì´ì¬ì—ì„œ XPathë¥¼ ì´ìš©í•œ HTMLë¬¸ì„œ íŒŒì‹±"
date:   2020-04-14 21:00:00 +0900
categories: python lxml html
---

íŒŒì´ì¬ì—ì„œ `lxml` íŒ¨í‚¤ì§€ë¡œ `XPath`ë¥¼ ì´ìš©í•´ HTMLë¬¸ì„œë¥¼ íŒŒì‹±í•˜ëŠ” ë²•ì„ ë‹¤ë£¨ì–´ ë´…ë‹ˆë‹¤.

`XPath`ë¥¼ ì´ìš©í•˜ë©´ ê²€ìƒ‰ëœ ì—˜ë¦¬ë©˜íŠ¸ë¥¼ ì½”ë“œë¡œ ì¬ê²€ìƒ‰í•˜ëŠ” ê³¼ì •ì„ `XPath` ë¬¸ë²•ì— ì‘ì„±í•˜ì—¬ ë³´ë‹¤ ê°„ê²°í•˜ê²Œ íŒŒì‹± ê³¼ì •ì„ êµ¬í˜„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

HTMLë¬¸ì„œì˜ íŒŒì‹±ì€ `BeautifulSoup` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ ë§ì´ ì†Œê°œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê°„ê²°í•˜ê³  ì‚¬ìš©í•˜ì§€ í¸ë¦¬í•˜ì§€ë§Œ, `XPath`ë¥¼ ìì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì´ëŸ¬í•œ ê²½ìš° ëŒ€ì‘ì±…ìœ¼ë¡œ `lxml`ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### lxml íŒ¨í‚¤ì§€ ì„¤ì¹˜
ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ `lxml`ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.
```
pip3 install lxml
```

### HTMLë¬¸ì„œ ë¡œë“œ
ë¡œì»¬ì— ì €ì¥ëœ íŒŒì¼ì´ë‚˜ ì¸í„°ë„·ì˜ URLì—ì„œ ë¬¸ì„œë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
```
import lxml.html
from lxml.html import HtmlElement

html_element = lxml.html.parse(
	DOCUMENT_PATH_OR_URL
) # type: HtmlElement
```

ì´ë¯¸ ë¡œë“œëœ str() ë¬¸ìì—´ë¡œ ë¡œë“œí•  ìˆ˜ ë„ ìˆìŠµë‹ˆë‹¤.
```
import lxml.html
from lxml.html import HtmlElement

html_element = lxml.html.document_fromstring(
	LOADED_DOCUMENT_STR
) # type: HtmlElement
```

----

## XPathë¡œ ê²€ìƒ‰í•˜ê¸°

#### ì£¼ìš” ë¬¸ë²• (expression)

`XPath`ëŠ” ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ì—°ì‚°ìë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ì´ë¥¼ ì¡°í•©í•˜ì—¬ ì›í•˜ëŠ” ê°ì²´ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

**ê²½ë¡œ ì—°ì‚°ì**

|ë¬¸ë²•|ì„¤ëª…|
|------|-------|
|/|ë£¨íŠ¸ ë…¸ë“œ(ë¬¸ì„œì˜ ì‹œì‘), ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•˜ì§€ ì•ŠìŒ.
|//|ì§€ì •í•œ ë…¸ë“œì—ì„œ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰.
|.|í˜„ì¬ ë…¸ë“œë¥¼ ì„ íƒ
|..|í˜„ì¬ ë…¸ë“œì˜ ë¶€ëª¨ ë…¸ë“œë¥¼ ì„ íƒ
|@|ì†ì„± ë…¸ë“œë¥¼ ì„ íƒ (HTMLì—ì„œ attributeì§€ì •)

**ë°©í–¥ ì—°ì‚°ì**

ì—˜ë¦¬ë©˜íŠ¸ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë°©í–¥ì„ ì§€ì •í•©ë‹ˆë‹¤.

|ë¬¸ë²•|ì„¤ëª…|
|------|-------|
|self|í˜„ì¬ ë…¸ë“œ
|attribute|í˜„ì¬ ë…¸ë“œì˜ ì†ì„± ë…¸ë“œ
|namespace|í˜„ì¬ ë…¸ë“œì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë…¸ë“œ
|child|í˜„ì¬ ë…¸ë“œì˜ ìì‹ ë…¸ë“œ
|descendant|í˜„ì¬ ë…¸ë“œì˜ ìì† ë…¸ë“œ (ìì‹ -> ìì†)
|descendant-or-self|í˜„ì¬ ë…¸ë“œì™€ ìì† ë…¸ë“œ
|following|í˜„ì¬ ë…¸ë“œì˜ ì¢…ë£Œ ì´í›„ ë“±ì¥í•˜ëŠ” ë…¸ë“œ
|following-sibling|í˜„ì¬ ë…¸ë“œ ì´í›„ ë“±ì¥í•˜ëŠ” í˜•ì œ ë…¸ë“œ
|parent|í˜„ì¬ ë…¸ë“œì˜ ë¶€ëª¨ ë…¸ë“œ
|ancestor|í˜„ì¬ ë…¸ë“œì˜ ì¡°ìƒ ë…¸ë“œ
|ancestor-or-self|í˜„ì¬ ë…¸ë“œì™€ ì¡°ìƒ ë…¸ë“œ
|preceding|í˜„ì¬ ë…¸ë“œ ì´ì „ì˜ ëª¨ë“  ë…¸ë“œ(ì¡°ìƒ,ì†ì„±, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë…¸ë“œ)
|preceding-sibling|í˜„ì¬ ë…¸ë“œ ì´ì „ì˜ í˜•ì œ ë…¸ë“œ

ìœ„ ì—°ì‚°ìë¥¼ ê²½ë¡œ í‘œí˜„ì‹(path expression)ìœ¼ë¡œ ì¡°í•©í•˜ì—¬ ê²€ìƒ‰í•©ë‹ˆë‹¤.
```
ë°©í–¥ì—°ì‚°ì::ê²½ë¡œì—°ì‚°ì[í•„í„°í‘œí˜„ì‹]
```

----

#### ì˜ˆì œ

ë‹¤ìŒ ì˜ˆì œë¥¼ í†µí•´ íƒœê·¸ ì´ë¦„ê³¼ ê²½ë¡œ, ì†ì„±ê°’ì„ ì´ìš©í•´ ì›í•˜ëŠ” ì—˜ë ˆë©˜íŠ¸ë¥¼ ê²€ìƒ‰í•˜ëŠ” ê¸°ë³¸ì ì¸ ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

\#1. ë¬¸ì„œì˜ ì „ì²´ì—ì„œ divíƒœê·¸ ì¤‘ idê°€ 'articleHead'ì¸ íƒœê·¸ì˜ ìì‹ (ìì†ì´ ì•„ë‹Œ) spaníƒœê·¸ì¸ ì—˜ë¦¬ë©˜íŠ¸ ì¤‘ ë‘ë²ˆì§¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
```
//div[@id='articleHead']/span[2]
```

\#2. ë¬¸ì„œì˜ ì „ì²´ì—ì„œ divíƒœê·¸ ì¤‘ idê°€ 'articleBodyContents' ì´ê³  classê°€ '\_article_body_contents'ì¸ ì—˜ë ˆë©˜íŠ¸ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
```
//div[@id='articleBodyContents' and @class='_article_body_contents']
```

\#3. ë¬¸ì„œì˜ ì „ì²´ì—ì„œ disabledì†ì„±ì„ ê°€ì§„ ëª¨ë“  ì—˜ë ˆë©˜íŠ¸ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
```
//*[@disabled]
```

\#4. ë¬¸ì„œì˜ ì „ì²´ì—ì„œ ì´ë¯¸ì§€ íƒœê·¸ ì¤‘, ë„ë©”ì¸ì´ `blog.live2skull.kr` ì¸ ì—˜ë ˆë©˜íŠ¸ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
```
//img[contains(@href, 'blog.live2skull.kr')]
```
----

#### ì‹¤í–‰ ê²°ê³¼

ì£¼ìš” ë¬¸ë²•ì„ ìƒí™©ì— ë”°ë¼ ì ì ˆíˆ ì¡°í•©í•˜ì—¬, ì›í•˜ëŠ” ì—˜ë¦¬ë©˜íŠ¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤. `XPath`ì— ë”°ë¥¸ ë¦¬í„´ê°’ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

\#1. ê°ì²´ë¥¼ ì„ íƒí•˜ëŠ” ê²½ìš° `list` ì…ë‹ˆë‹¤. íŠ¹ì • ì¸ë±ìŠ¤ë¥¼ ì§€ì •í•˜ì—¬ **í•˜ë‚˜ì˜ ê°ì²´ë§Œ ì„ íƒ** í•˜ì—¬ë„, ë°˜í™˜ í˜•ì‹ì€ ë™ì¼í•©ë‹ˆë‹¤.

```
>>> elem.xpath('//div')
[<Element div at 0x108f855f0>, <Element div at 0x108f85110>, ... ]
>>> elem.xpath('//div[1]')
[<Element div at 0x108f855f0>]
```
\#2. `string()` ê³¼ ê°™ì€ ë¬¸ìì—´ ì¶œë ¥ì€ ê°ì²´ í•˜ë‚˜ë§Œì„ ë°˜í™˜í•©ë‹ˆë‹¤.
```
>>> elem.xpath('string()')
... \';\nvar _MAIN_NEWS_MENU_ID=\'shm\';\nvar _MAIN_NEWS_SEC ...
>>> type(elem.xpath('string()'))
<class 'lxml.etree._ElementUnicodeResult'> # str()ì™€ ë™ì¼íˆ ì‚¬ìš© ê°€ëŠ¥
```

## ì—˜ë¦¬ë©˜íŠ¸ ê°’ ì¶”ì¶œ

ì›í•˜ëŠ” ì—˜ë¦¬ë©˜íŠ¸ë¥¼ ì°¾ì•˜ë‹¤ë©´, í•„ìš”í•œ ê°’ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.

#### íƒœê·¸ ì´ë¦„

```
>>> img_elem.tag
'img'
```

#### ì†ì„± (attribute)

```
>>> img_elem.attrib
{'src' : 'https://blog.live2skull.kr/...', ... } # dict ì™€ ë™ì¼íˆ ì‚¬ìš© ê°€ëŠ¥
>>> img_elem.attrib['src']
'https://blog.live2skull.kr/...'
```


#### ì—˜ë¦¬ë©˜íŠ¸ ë¬¸ìì—´ êµ¬í•˜ê¸°
ì—˜ë¦¬ë©˜íŠ¸ì˜ ìì‹ ë…¸ë“œê¹Œì§€ì˜ í…ìŠ¤íŠ¸ êµ¬í•˜ê¸°
```
message = element.text_content()
```


#### ì „ì²´ ë¬¸ìì—´ ë°ì´í„°

âš ï¸ ë‚´ë¶€ êµ¬í˜„ì„ í™•ì¸í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. `BeautifulSoup` ì—ì„œì˜ `.string` ë‚´ë¶€ ë¬¸ìì—´ ì¶”ì¶œ ë©”ì„œë“œì™€ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

âš ï¸ íƒœê·¸ì— ì‚½ì…ëœ í…ìŠ¤íŠ¸ê°€ '\n'ì´ ì•„ë‹Œ `BR` íƒœê·¸ë¡œ êµ¬ë¶„ë˜ì—ˆë‹¤ë©´, ì¤„ë°”ê¿ˆì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

âš ï¸ `.text` ë©”ì„œë“œê°€ ìƒí™©ì— ë”°ë¼ ì˜ë„í•œ ëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë…¸ë“œì™€ ë…¸ë“œì˜ ì „ì²´ ìì‹ ë…¸ë“œ ì¤‘ comment ì—˜ë¦¬ë©˜íŠ¸ì™€ ì¼ë¶€ë¥¼ ì œì™¸í•˜ê³ , `<div>general message</div>` ì™€ ê°™ì´ íƒœê·¸ ë‚´ë¶€ì— ì‚½ì…ëœ ë¬¸ìì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

```
>>> html_element = lxml.html.document_fromstring(
	'<div>general message</div>'
)
>>> html_element.text_content()
'general message'
```

#### ë¶€ëª¨ / ìì‹ ë…¸ë“œ, ì´ì „ / ë‹¤ìŒ ë…¸ë“œ ì ‘ê·¼
`getparent()` ë¶€ëª¨ ë…¸ë“œ ì ‘ê·¼
```
>>> element.getparent()
<Element div at 0x108f85a70>
```

`getchildren()` ìì‹ ë…¸ë“œ ì ‘ê·¼. ë°˜í™˜ í˜•ì‹ì€ `list` ì…ë‹ˆë‹¤. for ë¬¸ìœ¼ë¡œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ë„ ìˆìŠµë‹ˆë‹¤.
```
>>> element.getchildren()
[<Element div at 0x108f85fb0>, <Element div at 0x108f85cb0>]

# ê°ì²´ì— iterationì„ ì§€ì›ìœ¼ë¯€ë¡œ forë¬¸ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
>>> for elem in element: print(elem)
<Element div at 0x108f85fb0>
...
```
ë§ˆì°¬ê°€ì§€ë¡œ `getprevious()` `getnext()` ë¡œ ì´ì „, ë‹¤ìŒ ë…¸ë“œì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë©°, ì ‘ê·¼ ê°€ëŠ¥í•œ ë…¸ë“œê°€ ì—†ë‹¤ë©´ `None`ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

----

## ì‹¤ìˆ˜í•˜ê¸° ì‰¬ìš´ ì½”ë“œ

ğŸ’¡ `XPath`ì˜ ì¸ë±ìŠ¤ ì‹œì‘ì€ **1** ì…ë‹ˆë‹¤.

ğŸ’¡ ë¬¸ì„œë¥¼ ë¡œë“œì‹œ ë°˜í™˜ë˜ëŠ” `_ElementTree` ì˜ ë£¨íŠ¸ëŠ” `body` ì—˜ë¦¬ë©˜íŠ¸ê°€ ì•„ë‹™ë‹ˆë‹¤. `_ElementTree->head,body-> ...` ì…ë‹ˆë‹¤.

ğŸ’¡ ê²€ìƒ‰ëœ ë…¸ë“œì—ì„œ ë‹¤ì‹œ ê²€ìƒ‰í•˜ê³ ì í•  ê²½ìš° `XPath`ì— ìƒëŒ€ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê²€ìƒ‰ëœ ë…¸ë“œ ë‚´ì—ì„œ ê²€ìƒ‰í•˜ì§€ ì•Šê³ , ì „ì²´ ë¬¸ì„œì—ì„œ ê²€ìƒ‰í•˜ê²Œ ë©ë‹ˆë‹¤.  
ìƒëŒ€ ê²½ë¡œë¡œ í‘œì‹œí•˜ê¸°: **'.//USER_DEFINED_PATH'** - ê²½ë¡œì˜ ì‹œì‘ì— '.' ì„ ë¶™ì…ë‹ˆë‹¤.
```
html_element = lxml.html.parse(DOCUMENT_PATH) # root element
article_element = html_element.xpath('//div[@id="articleInfo"]')[0]

## article_element ë‚´ë¶€ì—ì„œ ê²€ìƒ‰í•˜ë ¤ê³  í•˜ë¯€ë¡œ, ìƒëŒ€ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
title_element = article_element.xpath('.//span[@id="title"]')[0]

## ë§Œì•½ ìƒëŒ€ ê²½ë¡œë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ë¬¸ì„œ ì „ì²´ì—ì„œ ì°¾ê²Œ ë©ë‹ˆë‹¤.
title_element = article_element.xpath('//span[@id="title"]')[0]
```


ğŸ’¡ ë¶ˆí•„ìš”í•œ ì—˜ë¦¬ë©˜íŠ¸ë¥¼ ì‚­ì œí•  ë•ŒëŠ” ë°˜ë“œì‹œ ëŒ€ìƒ ì—˜ë¦¬ë©˜íŠ¸ì˜ ë¶€ëª¨ ì—˜ë¦¬ë©˜íŠ¸ì—ì„œ ì‚­ì œí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ, íŒŒì‹±ëœ ìµœìƒìœ„ ë£¨íŠ¸ ì—˜ë¦¬ë©˜íŠ¸ì—ì„œëŠ” ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (`_ElementTree` ì—ì„œ ì‚­ì œ ë¶ˆê°€ / `HtmlElement` ì—ì„œ ì‚­ì œ ê°€ëŠ¥)
```
>>> a.remove(b) # a ë…¸ë“œì—ì„œ b ë…¸ë“œë¥¼ ì‚­ì œí•˜ëŠ” ì˜ˆì œ
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "src/lxml/etree.pyx", line 943, in lxml.etree._Element.remove
ValueError: Element is not a child of this node.
# aê°€ bì˜ ë°”ë¡œ ìƒìœ„ ë…¸ë“œê°€ ì•„ë‹ˆë¯€ë¡œ, ì‚­ì œí•  ìˆ˜ ì—†ìŒ.
```
