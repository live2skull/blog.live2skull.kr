---
layout: post
title:  "μλ°” - JPA(Java Persistance API)"
date:   2020-04-23 16:00:00 +0900
categories: java
---

μλ°”μ JPA(Java Persistance API)μ— λ€ν•΄μ„ μ•μ•„λ΄…λ‹λ‹¤.

β οΈ μ¶”κ°€ μμ •  
[(repo) JPA custom examples](about:blank)

## Persistance APIκ°€ λ¬΄μ—‡μΈκ°€μ”?
λ‹¤λ‰μ λ°μ΄ν„°λ¥Ό μƒμ„±, κ²€μƒ‰, μμ •, μ‚­μ  (CRUD) ν•κΈ° μ„ν•΄ λ°μ΄ν„°λ² μ΄μ¤μ λ„μ…μ€ κ±°μ ν•„μμ μ΄λΌκ³  ν•  μ μμµλ‹λ‹¤. ν•μ§€λ§ RDBMSμ™€ μλ°”μ OOP κ°μ²΄μ λ¶μΉ μΉλ΅ μΈν• ν¨λ¬λ‹¤μ„μ΄ λ°μƒν•μ€κ³ , μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ κ°μ²΄μ™€ RDBMSλ¥Ό λ§¤ν•‘ν•λ” μ—­ν• μ„ ν•λ” ORM(Object-Related Model)μ κ·κ²©μΌλ΅μ¨ `JPA`λ¥Ό λ§λ“¤μ—μµλ‹λ‹¤.

JPAλ” RDBMSμ™€ κ°μ²΄λ¥Ό λ§µν•‘ν•λ” ORMμ κµ¬ν„μ²΄κ°€ μ•„λ‹ μΈν„°νμ΄μ¤λ΅μ„, μΌμΆ…μ κ·κ²©μΌλ΅ μ΄ν•΄ν•λ©΄ λ©λ‹λ‹¤. μ‚¬μ©μλ” `JPA`μ μΈν„°νμ΄μ¤λ¥Ό μ¤€μν•μ—¬ `μ—”ν‹°ν‹° ν΄λμ¤, Repository`λ¥Ό μ‘μ„±ν•λ©΄, `Hibernate, TopLink, CoCoBase` λ“± `JPA`μ— λ§μ¶”μ–΄ μ‹¤μ  κµ¬ν„λμ–΄ μλ” ORM ν”„λ μ„μ›ν¬μ—μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

ORM ν”„λ μ„μ›ν¬κ°€ `JPA`λ¥Ό μ¤€μν•μ—¬ λ§λ“¤μ—κΈ° λ•λ¬Έμ—, μ‚¬μ©μ μ…μ¥μ—μ„λ” μ–΄λ– ν• ν”„λ μ„μ›ν¬λ¥Ό μ‚¬μ©ν•΄λ„ λ™μΌν• μ—”ν‹°ν‹° κµ¬ν„μ„ μ΄μ©ν•΄μ„ ORMμ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.


## κµ¬μ„±μ”μ†

|μ΄λ¦„|μ—­ν• |
|---|-----|
|Entity|ν•„λ“ μ»¬λΌ νƒ€μ… λ“±
|Repository|λ°μ΄ν„°λ² μ΄μ¤ μ ‘κ·Ό λ° CRUD κ³Όμ • 

π’΅ μ›Ή ν”„λ μ„μ›ν¬(Spring Framework λ“±)κ³Ό μ—°λ™μ„ μ„ν• μ¶”κ°€μ μΈ κµ¬ν„μ€ ν•΄λ‹Ή ν”„λ μ„μ›ν¬ λ¶„μ„μ—μ„ λ‹¤λ£Ήλ‹λ‹¤.

### μ—”ν‹°ν‹° μ‘μ„±

λ‹¤μμ€ μ‘μ„±λ μ—”ν‹°ν‹°μ μμ μ…λ‹λ‹¤.
```
package com.example.demo.domain;
import lombok.*;
import javax.persistence.*;

@Entity
@Getter
@NoArgsConstructor(access = Access.PROTECTED)
public class Song
{
    @Id
    @GeneratedValue
    private Long id;
    
    @Column(length=100, nullable=false)
    private String title;
    
    public void updateTitle(String title)
    {
        this.title = title;
    }

    @Builder
    public Song(String title)
    {
        this.title = title;
    }
}
```
π’΅ lombok annotationμ μμ„Έν• μ„¤λ…μ€  ν•΄λ‹Ή ν”„λ μ„μ›ν¬ λ¶„μ„μ—μ„ λ‹¤λ£Ήλ‹λ‹¤.

- `@Entity` λ¥Ό ν΄λμ¤μ— μ μ©ν•¨μΌλ΅μ¨, ν•΄λ‹Ή ν΄λμ¤κ°€ μ—”ν‹°ν‹° ν΄λμ¤μ„μ„ μ„ μ–Έν•©λ‹λ‹¤.
- `@Getter` λ¨λ“  ν•„λ“(μ»¬λΌ)μ— λ€ν• μ½κΈ°λ” ν—μ©ν–μ§€λ§, ν•„λ“λ¥Ό μ „λ¶€ privateλ΅ μ„ μ–Έ ν•¨μΌλ΅μ¨, ν•„λ“μ λ¬΄λ¶„λ³„ν• μμ •μ„ μ ν•ν–μµλ‹λ‹¤. 
- λ§μ•½ λ¨λ“  ν•„λ“μ— λ€ν—¤ setterλ¥Ό μ„¤μ •ν•κ±°λ‚, μμ •μ΄ κ°€λ¥ν•κ² ν•λ‹¤λ©΄ νΉμ • κ°’μ΄ μ–΄λ μ‹μ μ— μ–΄λ– ν• μλ„λ΅ λ³€κ²½λ μ§€ μ• μ μ—†μΌλ―€λ΅, μλ„μΉ μ•μ€ μƒν™©μ΄ λ°μƒν•  μ μκ² λ©λ‹λ‹¤.
- λ”°λΌμ„ μ„ μμ μ `updateTitle` λ©”μ„λ“μ™€ κ°™μ΄ νΉμ • ν–‰μ„λ¥Ό ν•κ³ μ ν•  λ• λ³€κ²½ν•  ν•„λ“λ¥Ό λ…ν™•ν ν•λ” setter λ©”μ†λ“λ¥Ό μ‘μ„±ν•μ—¬ μ‚¬μ©ν•©λ‹λ‹¤.



### μ–΄λ…Έν…μ΄μ…

μ•„λμ—μ„ ν•„λ“λ¥Ό RDBMSλ΅ λ³€κ²½ν•λ” μμ λ” `mysql`μ„ λ€μƒμΌλ΅ μ„¤λ…ν•©λ‹λ‹¤.


**@Entity**  
μ μ©ν• ν΄λμ¤λ¥Ό `JPA Entity`λ΅ μ„ μ–Έν•©λ‹λ‹¤.

**@Id**  
μ μ©ν• ν•„λ“λ¥Ό primary keyλ΅ μ‚¬μ©ν•©λ‹λ‹¤.

**@GeneratedValue**  
`@Id` μ–΄λ…Έν…μ΄μ…μ„ μ μ©ν• primary key ν•„λ“μ— μ μ©ν•λ©΄, mysql κΈ°μ¤€μΌλ΅ auto_incrementλ¥Ό μ μ©ν•©λ‹λ‹¤. λ‹¨, ν•„λ“λ” `Long` νƒ€μ…λ§ μ‚¬μ©ν•  μ μμΌλ©°, mysql μ—μ„λ” `BIGINT` νƒ€μ…μ„ κ°–κ² λ©λ‹λ‹¤.   
μ΄μ™Έμ—λ„ **strategy** μ†μ„±μΌλ΅ μλ™ μƒμ„± μµμ…μ„ μ§€μ •ν•  μ μμµλ‹λ‹¤.

**@Column**  
ν•„λ“λ¥Ό RDBMSμ–΄ μ„ μ–Έν•λ” DDL λ¬Έμ„ μƒμ„±ν•λ” μµμ…μ„ μ κ³µν•©λ‹λ‹¤.  
κΈ°λ³Έμ μΌλ΅ `@Entity`λ΅ μ„ μ–Έλ ν΄λμ¤μ λ¨λ“  ν•„λ“λ” λ¨λ‘ μ»¬λΌμΌλ΅ μ‚¬μ©λλ―€λ΅ μµμ…μ„ μ κ³µν•κ³ μ ν•λ” ν•„λ“μ—λ§ μ„ μ–Έν•λ©΄ λ©λ‹λ‹¤.  

μ‚¬μ© κ°€λ¥ν• μµμ…

|μ΄λ¦„|μµμ…|
|---|-----|
|columnDefinition|ν•„λ“ μ»¬λΌ νƒ€μ… λ“±
|unique|ν•„λ“μ unique μ„¤μ • μ—¬λ¶€. 2κ° μ΄μƒμ€ λ³„λ„μ λ°©λ²•μ„ μ‚¬μ©.
|nullable|ν•„λ“μ null κ°’ ν—μ© μ—¬λ¶€.
|length|ν•„λ“μ λ°μ΄ν„° ν¬κΈ°.

π’΅ ν•λ‚μ `Entity`μ—μ„ λ‘ κ° μ΄μƒμ μ»¬λΌμ— `unique` μ„¤μ •ν•λ©΄, λ°μ΄ν„°λ² μ΄μ¤μ—μ„λ” `unique`κ°€ μ„¤μ •λ μ»¬λΌλ“¤μ„ λ³„λ„μ ν…μ΄λΈ”μ„ λ§λ“¤μ–΄ κ΄€λ¦¬ν•©λ‹λ‹¤. `@UniqueConstranits` λ΅ μ„¤μ •ν•λ©° λ‹¤μμ„ λ”°λ¦…λ‹λ‹¤. [μ¶”κ°€ μμ •](about:blank)

μ) `String` νƒ€μ…μ μ»¬λΌμ DDL μ»¬λΌ νƒ€μ… λ³€κ²½  
`String` νƒ€μ…μ€ κΈ°λ³Έμ μΌλ΅ `VARCHAR`λ΅ λ³€ν™λλ‚, μµμ…μ„ μ κ³µν•μ—¬ `TEXT` νƒ€μ…μ„ μ‚¬μ©ν•λ„λ΅ μ§€μ •ν–μµλ‹λ‹¤.
```
@Column(columnDefinition = "TEXT", nullable = false)
private String lyric;
```